<html>
  <head>
    <style>
      .rectangle {
        width: 200px;
        height: 100px;
        border-style: solid;
        border-width: 3px;
        margin: 10px;
      }
      #tooltip {
        background-color: #333;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 13px;
      }
    </style>
    <script src="https://unpkg.com/popper.js@1"></script>
    <script src="https://unpkg.com/tippy.js@5"></script>
    <script>
      window.addEventListener('load', (event) => {
        tippy('.rectangle', {
          content: 'Loading...',
          flipOnUpdate: true,
          onCreate(instance) {
            instance._isFetching = false;
            instance._isLoaded = false;
            instance._error = null;
          },
          onShow(instance) {
            if (instance._isFetching || instance._isLoaded || instance._error) {
              return;
            }
            instance._isFetching = true;
            var rectName = instance.reference.dataset.name;
            fetch('/tooltip/' + encodeURIComponent(rectName))
              .then(response => response.json())
              .then(jsonResponse => {
                instance._isLoaded = true;
                instance.setContent(`<span>${jsonResponse.message}</span>`);
              })
              .catch(error => {
                instance._error = error;
                instance.setContent(`Request failed. ${error}`);
              })
              .finally(() => {
                instance._isFetching = false;
              });
          },
          onHidden(instance) {
            instance.setContent('Loading...');
            instance._isLoaded = false;
            instance._error = null;
          }
        });
      });
    </script>
  </head>
  <body>
    <div class="rectangle" data-name="r1"></div>
    <div class="rectangle" data-name="r2"></div>
    <div class="rectangle" data-name="r3"></div>
  </body>
</html>
